---
title: '[React] Presigned URLì™€ AWS Lambdaë¡œ êµ¬í˜„í•œ ìë™ WebP ë³€í™˜ ì´ë¯¸ì§€ ì—…ë¡œë“œ íŒŒì´í”„ë¼ì¸'
author: 'Eunwoo'
thumbnail: '/thumbnail/reactjs.webp'
publishDate: '2025-10-14'
categoryId: 6
keywords:
  [
    'React',
    'AWS',
    'S3',
    'Presigned URL',
    'Lambda',
    'WebP',
    'Sharp',
    'ì´ë¯¸ì§€ ìµœì í™”',
    'ì´ë¯¸ì§€ ì—…ë¡œë“œ',
    'PutObject',
    'ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ',
    'LCP',
    'ì„±ëŠ¥ ìµœì í™”',
  ]
description: 'AWS Presigned URLê³¼ Lambdaë¡œ ìë™ WebP ë³€í™˜ ì´ë¯¸ì§€ ì—…ë¡œë“œ êµ¬í˜„. S3 ì§ì ‘ ì—…ë¡œë“œ, Lambda Sharp ë³€í™˜, ì´ë¯¸ì§€ ìµœì í™” íŒŒì´í”„ë¼ì¸ ì™„ë²½ ê°€ì´ë“œ.'
---

ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•´, Presigned URLì„ í™œìš©í•œ ì§ì ‘ S3 ì—…ë¡œë“œ + Lambda ìë™ ë³€í™˜(ì›¹í¬/WebP, ë¦¬ì‚¬ì´ì¦ˆ) íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í–ˆë‹¤.
ì´ˆê¸°ì—ëŠ” ë°±ì—”ë“œ ì„œë²„ê°€ íŒŒì¼ì„ ë°›ì•„ S3ë¡œ ë‹¤ì‹œ ì—…ë¡œë“œí•˜ë ¤ í–ˆì§€ë§Œ, ë‹¤ìŒ ë¬¸ì œê°€ ìˆì—ˆë‹¤.

- 1. ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ ì „ì†¡ìœ¼ë¡œ ì„œë²„ íŠ¸ë˜í”½/CPU/ë©”ëª¨ë¦¬ ë¶€ë‹´ ì¦ê°€
- 2. ë‘ ë²ˆì˜ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©(í´ë¼ì´ì–¸íŠ¸â†’ì„œë²„â†’S3)
- 3. ì—…ë¡œë“œ í¬ë§·ì´ ì œê°ê°ì´ë¼ ìš©ëŸ‰ ë¹„íš¨ìœ¨ ë° ì´ë¯¸ì§€ ì¼ê´€ì„± ë¶€ì¡±

ì´ë¥¼ Presigned URL ê¸°ë°˜ìœ¼ë¡œ ì „í™˜í•´, í”„ë¡ íŠ¸ê°€ ì§ì ‘ S3ì— ì—…ë¡œë“œí•˜ê³  S3 ì—…ë¡œë“œ ì´ë²¤íŠ¸ë¡œ Lambdaê°€ ìë™ ì‹¤í–‰ë˜ë„ë¡ êµ¬ì„±í–ˆë‹¤. Lambdaê°€ Sharpë¡œ WebP ë³€í™˜ + ë¦¬ì‚¬ì´ì¦ˆë¥¼ ìˆ˜í–‰í•´ ìš©ëŸ‰ì„ í¬ê²Œ ì¤„ì´ê³  LCP ê°œì„ ê¹Œì§€ ë…¸ë ¸ë‹¤.

ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ì‹œê°í™”í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```
[Client] â”€(1) GET /presigned-urlâ†’ [Backend]
    â†“
(2) PUT image.jpg â†’ [S3 Bucket]
    â†“
(3) S3 Event Trigger â†’ [Lambda Function]
    â†“
(4) Lambda uses Sharp to resize + convert WebP
    â†“
(5) Save to S3 /resized-image/ directory
```

- ë°±ì—”ë“œê°€ S3 PutObjectì— ëŒ€í•œ Presigned URLì„ ë°œê¸‰
- í”„ë¡ íŠ¸ëŠ” ê·¸ URLë¡œ ì§ì ‘ PUT ì—…ë¡œë“œ (ì„œë²„ë¥¼ ì•ˆ ê±°ì¹¨)
- S3 ì—…ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸ë¡œ Lambda ìë™ ì‹¤í–‰ â†’ ë³€í™˜/ë¦¬ì‚¬ì´ì¦ˆ í›„ ë³„ë„ í”„ë¦¬í”½ìŠ¤ì— ì €ì¥

í•µì‹¬ì€ ë°±ì—”ë“œì—ì„œ S3 PutObjectCommand ê¸°ë°˜ presigned URLë¥¼ ë°œê¸‰í•˜ë©´ í”„ë¡ íŠ¸ì—”ë“œëŠ” ì´ presigned URLì„ í†µí•´ ì§ì ‘ S3ì— ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.
ì´ì œ ìì„¸í•œ êµ¬í˜„ ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.

# Presigned URLì´ë€?

ì„œë²„(ë°±ì—”ë“œ)ê°€ AWS ìê²©ì¦ëª…(IAM Role/Key) ìœ¼ë¡œ íŠ¹ì • ê°ì²´ì— ëŒ€í•œ ìš”ì²­(ì˜ˆ: S3 PutObject, GetObject) ì„ ì§§ì€ ìœ íš¨ê¸°ê°„ê³¼ í•¨ê»˜ ë””ì§€í„¸ ì„œëª…í•˜ì—¬ URLì— ë‹´ì•„ ì¤€ ê²ƒì´ë‹¤.
ì¦‰, "ê¶Œí•œ ìˆëŠ” ì„œë²„ê°€ ëŒ€ì‹  ì„œëª…í•´ ì¤€ ìš”ì²­"ì„ ì¼ì‹œì ìœ¼ë¡œ ìœ„ì„ë°›ëŠ” ë°©ì‹ì´ë‹¤. ê·¸ë˜ì„œ Presigend URLì€ ìœ íš¨ì‹œê°„ì´ ì§€ë‚˜ë©´ ë¬´íš¨í™”ëœë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ, í´ë¼ì´ì–¸íŠ¸ëŠ” ìê²©ì¦ëª… ì—†ì´ë„ ì´ URLë§Œ ìˆìœ¼ë©´ ì§ì ‘ S3ì— ì—…/ë‹¤ìš´ë¡œë“œê°€ ê°€ëŠ¥í•˜ë‹¤.

![](https://velog.velcdn.com/images/eunwoo1341/post/ca2ce37a-5587-48d1-b984-477a35394e15/image.png)

## Presigned URL ì‚¬ìš©í•˜ëŠ” ì´ìœ 

- ì„±ëŠ¥/ë¹„ìš©: ì´ë¯¸ì§€Â·ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ë°±ì—”ë“œë¥¼ ê²½ìœ í•˜ì§€ ì•Šê³  ê³§ë°”ë¡œ S3ë¡œ ì „ì†¡ â†’ ì„œë²„ íŠ¸ë˜í”½Â·CPUÂ·ë©”ëª¨ë¦¬ ë¶€ë‹´â†“, ë„¤íŠ¸ì›Œí¬ ë¹„ìš©â†“.
- ë³´ì•ˆ: ìê²©ì¦ëª…ì„ í”„ë¡ íŠ¸ì— ë…¸ì¶œí•˜ì§€ ì•ŠìŒ. URLì€ ì§§ì€ ë§Œë£Œì‹œê°„ì´ ìˆì–´ ìœ ì¶œ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”.
- ë‹¨ìˆœì„±: í”„ë¡ íŠ¸ëŠ” ë”± URL í•˜ë‚˜ë¡œ ì—…/ë‹¤ìš´ë¡œë“œ fetch/PUT í•˜ë©´ ë.

# Reactì—ì„œ Presigned URL ìˆ˜ë ¹ ë° AWS S3 ì—…ë¡œë“œ ë¡œì§ êµ¬í˜„í•˜ê¸°

## 1. ë°±ì—”ë“œë¡œë¶€í„° Presigned URL ìˆ˜ë ¹

ì²˜ìŒì— ë°±ì—”ë“œë¡œë¶€í„° Presigned URLì„ ë°›ì•„ì™€ì„œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ìš©í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.

```tsx
interface PresignedUrlRequest {
  imageName: string;
  imageType: string;
}

interface PresignedUrlResponse {
  presignedUrl: string;
  filePath: string;
}

const getPresignedUrl = async (data: PresignedUrlRequest): Promise<PresignedUrlResponse> => {
  const response = await api.post('/storage/upload-url', data);
  return response.data.data;
};
```

PresignedUrlë¥¼ ë°›ê¸° ìœ„í•´ Client ì¸¡ì—ì„œëŠ” imageNameê³¼ imageTypeì„ bodyë¡œ ì „ë‹¬í•œë‹¤.
ì´ë¥¼ í†µí•´ ë°±ì—”ë“œëŠ” AWSë¡œë¶€í„° PresignedUrlì„ ë°œê¸‰í•˜ì—¬ Clientì— ì „ë‹¬í•œë‹¤.

## 2. ë°›ì€ PresignedUrlë¥¼ í†µí•´ AWS S3ì— ì—…ë¡œë“œ

Clientì—ì„œëŠ” ë°±ì—”ë“œë¡œë¶€í„° ë°›ì€ PresignedUrlì„ í†µí•´ S3ì— ì—…ë¡œë“œë¥¼ í•œë‹¤.

ì´í›„ ë°›ì€ PresignedUrlë¥¼ í†µí•´ Clientì—ì„œ s3ì— ì§ì ‘ ì—…ë¡œë“œí•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ì˜€ë‹¤.

```tsx
export const uploadImageToS3 = async (presignedUrl: string, file: FileType): Promise<void> => {
  const response = await axios.put(presignedUrl, file, {
    headers: {
      'Content-Type': file.type,
    },
  });

  if (response.status !== 200) {
    throw new Error(`Failed to upload image: ${response.statusText}`);
  }
};
```

# Image ë¯¸ë¦¬ë³´ê¸° ë¡œì§ êµ¬í˜„í•˜ê¸°

ì•„ë˜ ì½”ë“œëŠ” ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•œ í›…ì´ë©°, ë¡œì»¬ ë¯¸ë¦¬ë³´ê¸°(Blob URL) ë¥¼ ë¨¼ì € ë³´ì—¬ì¤€ ë’¤, ì—…ë¡œë“œ ì™„ë£Œ í›„ S3 ê²½ë¡œë¡œ ë¯¸ë¦¬ë³´ê¸° ì£¼ì†Œë¥¼ êµì²´í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ë‹¤.

```tsx
export const useFileUpload = ({ onImageChange }: UseFileUploadProps) => {
  const [uploadedImage, setUploadedImage] = useState<UploadedImage | null>(null);
  const [uploading, setUploading] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const { mutateAsync: getPresignedUrl } = usePresignedUrlMutation();

  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const files = Array.from(event.target.files || []);
    if (files.length === 0) return;

    const file = files[0];

    setUploading(true);
    try {
      // 1) Presigned URL ë°œê¸‰
      const { presignedUrl, filePath } = await getPresignedUrl({
        imageName: file.name,
        imageType: file.type,
      });

      // 2) ì¦‰ì‹œ ì‚¬ìš©ìì—ê²Œ ë¡œì»¬ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë³´ì—¬ì¤Œ
      const localPreviewUrl = window.URL.createObjectURL(file);

      const tempUploadedImage: UploadedImage = {
        file,
        imageUrl: filePath, // ì—…ë¡œë“œë  S3 ì›ë³¸ ê²½ë¡œ
        imageName: file.name,
        previewUrl: localPreviewUrl, // ë¨¼ì € Blob URLë¡œ ì¦‰ì‹œ í”„ë¦¬ë·°
      };

      setUploadedImage(tempUploadedImage);
      onImageChange({ imageUrl: filePath, imageName: file.name });

      // 3) S3ë¡œ ì‹¤ì œ ì—…ë¡œë“œ
      await uploadImageToS3(presignedUrl, file);

      // 4) ì—…ë¡œë“œ ì„±ê³µ ì‹œ, í”„ë¦¬ë·°ë¥¼ S3 ì‹¤ì œ URLë¡œ êµì²´
      setUploadedImage((prev) => ({ ...prev!, previewUrl: filePath }));

      // (ì„ íƒ) Blob URL ë©”ëª¨ë¦¬ í•´ì œ
      window.URL.revokeObjectURL(localPreviewUrl);
    } catch (error) {
      console.error('Failed to process image:', error);
      alert('ì´ë¯¸ì§€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setUploading(false);
    }

    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const removeImage = () => {
    if (uploadedImage) {
      if (uploadedImage.previewUrl.startsWith('blob:')) {
        window.URL.revokeObjectURL(uploadedImage.previewUrl);
      }
      setUploadedImage(null);
      onImageChange(null);
    }
  };

  const triggerFileInput = () => fileInputRef.current?.click();

  return {
    uploadedImage,
    uploading,
    fileInputRef,
    handleFileSelect,
    removeImage,
    triggerFileInput,
    canAddImage: !uploadedImage && !uploading,
  };
};
```

![](https://velog.velcdn.com/images/eunwoo1341/post/1b02221c-b0fe-4035-b61c-2ed5b629b53d/image.png)

## ì—…ë¡œë“œ ì™„ë£Œ í›„ ì‹¤ì œ S3 URLë¡œ êµì²´

ì—¬ê¸°ì„œ êµ³ì´ ë¡œì»¬ ë¯¸ë¦¬ë³´ê¸°ë¡œ ê³„ì† ë³´ì—¬ì£¼ë©´ ë˜ëŠ”ë°,
ì™œ "ë¡œì»¬ ë¯¸ë¦¬ë³´ê¸° â†’ ì‹¤ì œ S3 URL"ë¡œ êµì²´í•˜ë‚˜? ë¼ëŠ” ì˜ë¬¸ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤.
ì¥ì ìœ¼ë¡œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

- 1. ì‚¬ìš©ì ê²½í—˜(ì†ë„)
     ì—…ë¡œë“œ ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ , ì¦‰ì‹œ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤.
     ëŒ€ìš©ëŸ‰ íŒŒì¼ë„ ë°”ë¡œ í”¼ë“œë°±ì„ ì£¼ë¯€ë¡œ ì—…ë¡œë“œ ì²´ê°ì´ ì¢‹ì•„ì§„ë‹¤.

- 2. ë©”ëª¨ë¦¬ ê´€ë¦¬
     Blob URLì€ ë©”ëª¨ë¦¬ë¥¼ ì¡ì•„ë¨¹ëŠ”ë‹¤. ì—…ë¡œë“œ ì„±ê³µ ì‹œ S3 URLë¡œ êµì²´ + URL.revokeObjectURL ë¡œ ë©”ëª¨ë¦¬ íšŒìˆ˜.

- 3. ê³µìœ /ìƒˆë¡œê³ ì¹¨/SSR ì¹œí™”ì„±
     Blob URLì€ ë¡œì»¬ ì„¸ì…˜ í•œì •ì´ë¼ ìƒˆë¡œê³ ì¹¨/ë‹¤ë¥¸ ê¸°ê¸° ê³µìœ ì— ë¶ˆë¦¬í•¨.
     S3 URLì€ ì˜ì†ì ì´ë¯€ë¡œ, ìƒˆë¡œê³ ì¹¨/ë”¥ë§í¬/SSR ìŠ¤ëƒ…ìƒ·/ì˜¤í”ˆê·¸ë˜í”„ ë“±ì—ì„œ ê¹¨ì§€ì§€ ì•ŠëŠ”ë‹¤.

- 4. ìºì‹± & CDN(CloudFront) ì˜ˆì—´
     ì‹¤ì œ URLë¡œ ë°”ê¾¸ë©´ ë¸Œë¼ìš°ì €/CloudFrontì— ìºì‹œê°€ ì¡íŒë‹¤. ë™ì¼ ë¦¬ì†ŒìŠ¤ ì¬ìš”ì²­ ì‹œ ì†ë„ í–¥ìƒ.
     ëª©ë¡ í™”ë©´ì´ë‚˜ ìƒì„¸ í™”ë©´ ì „í™˜ ì‹œ ì´ˆê¸° LCP ê°œì„ ì— ê¸°ì—¬.

# CloudFront ì„¤ì •ìœ¼ë¡œ ì¸í•œ Image ìµœì í™”

ë§ì€ Imageë“¤ì„ ë¸Œë¼ìš°ì €ì— ë¡œë“œí•˜ëŠ” ê²½ìš°ì—ëŠ” íš¨ìœ¨ì ì´ê³  ë¹ ë¥´ê²Œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ CloudFrontì— ìºì‹œë¥¼ ì¡ì•„ë‘ë„ë¡ í•˜ì˜€ë‹¤.

![](https://velog.velcdn.com/images/eunwoo1341/post/9e3f54fa-69f3-4f31-ac3e-98b2051c0114/image.png)

Cloudfrontì˜ Originì„ ì´ë¯¸ì§€ê°€ ë‹´ê¸´ S3 Bucketê³¼ ì—°ë™í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ í•˜ì˜€ë‹¤.
ê·¸ëŸ¬ë©´ ê²°ê³¼ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://velog.velcdn.com/images/eunwoo1341/post/7ec859bc-2fbb-45ff-86f7-c004b827dfff/image.png)

# AWS Lambda í•¨ìˆ˜ë¥¼ í†µí•˜ì—¬ WebP ë³€í™˜ ë° ë¦¬ì‚¬ì´ì¦ˆ ìµœì í™”

AWS Lambda í•¨ìˆ˜ë¥¼ í†µí•˜ì—¬ WebP ë³€í™˜ ë° ë¦¬ì‚¬ì´ì¦ˆë¥¼ í•˜ì—¬ ì´ë¯¸ì§€ ìµœì í™” ì‘ì—…ì„ í•˜ì˜€ë‹¤.
ì´ì „ì—ëŠ” ì‚¬ìš©ìê°€ JPG, JPEG, PNG ë“± ë‹¤ì–‘í•œ í¬ë§·ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ S3ì— ì €ì¥ë˜ê³ , ì´í›„ í¬ê¸°ê°€ í° ì›ë³¸ Imageë“¤ì´ ë¸Œë¼ìš°ì €ì— ê·¸ëŒ€ë¡œ ë¡œë“œë˜ì—ˆë‹¤.
ì´ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´ ë” ë§ì€ ë©”ëª¨ë¦¬ì™€ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì´ ì†Œìš”ë˜ì—ˆë‹¤.

ë”°ë¼ì„œ Lambda í•¨ìˆ˜ë¥¼ í†µí•˜ì—¬ WebP ë³€í™˜ ìµœì í™”í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë” ë¹ ë¥´ê²Œ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì£¼ë„ë¡ í•˜ì˜€ë‹¤.

![](https://velog.velcdn.com/images/eunwoo1341/post/d802ac26-7a08-4245-8be8-cafb1decbd13/image.png)

ì´ë¯¸ì§€ê°€ ì €ì¥ëœ S3 Bucketê³¼ ì—°ë™ì„ í•˜ì—¬ í•´ë‹¹ Bucketì— ì´ë¯¸ì§€ê°€ ì˜¬ë¼ì˜¤ë©´ Triggerë¥¼ í†µí•˜ì—¬ Lambda í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡ í•˜ì˜€ë‹¤.
webp ë³€í™˜ ë° ë¦¬ì‚¬ì´ì¦ˆë¥¼ í•˜ëŠ” Lambda í•¨ìˆ˜ì˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```tsx
// index.js
const { S3Client, GetObjectCommand, PutObjectCommand } = require('@aws-sdk/client-s3');
const { Readable } = require('stream');
const sharp = require('sharp');

const s3 = new S3Client({ region: 'ap-northeast-2' }); // ë¦¬ì „ì€ í™˜ê²½ì— ë§ê²Œ ë³€ê²½

exports.handler = async (event) => {
  const bucket = event.Records[0].s3.bucket.name;
  // decodeURIComponentë¥¼ ì‚¬ìš©í•´ í•œê¸€ ê¹¨ì§ ë°©ì§€
  const key = decodeURIComponent(event.Records[0].s3.object.key.replace(/\+/g, ' '));

  // ë¦¬ì‚¬ì´ì¦ˆëœ ì´ë¯¸ì§€ë‚˜ íŠ¹ì • ê²½ë¡œì˜ ì´ë¯¸ì§€ëŠ” ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ (ë¬´í•œì—…ë¡œë“œ ë°©ì§€)
  if (key.startsWith('resized-image/')) {
    return;
  }

  const fileName = key.split('/').pop();
  const baseFileName = fileName.split('.').slice(0, -1).join('.'); // í™•ì¥ìë¥¼ ì œì™¸í•œ íŒŒì¼ëª…ë§Œ ì¶”ì¶œ
  // resized-image í´ë”ì— ë¦¬ì‚¬ì´ì§• ì™„ë£Œí•œ ì´ë¯¸ì§€(resized-{íŒŒì¼ëª…}.webp) í˜•ì‹ìœ¼ë¡œ ì €ì¥
  const dstKey = `resized-image/resized-${baseFileName}.webp`;

  try {
    const response = await s3.send(new GetObjectCommand({ Bucket: bucket, Key: key }));
    var stream = response.Body;

    if ((!stream) instanceof Readable) {
      console.log('Unknown object stream type');
      return;
    }

    const content_buffer = Buffer.concat(await stream.toArray());

    const width = 90; // ë¦¬ì‚¬ì´ì§• í›„ ë„ˆë¹„
    const height = 90; // ë¦¬ì‚¬ì´ì§• í›„ ë†’ì´

    const output = await sharp(content_buffer)
      .resize(width, height, { fit: 'inside' }) // ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œ ê½‰ ì°¨ê²Œ ë¦¬ì‚¬ì´ì¦ˆ
      .webp({ lossless: true }) // ë¬´ì†ì‹¤ webpë¡œ ë³€í™˜
      .toBuffer();

    await s3.send(
      new PutObjectCommand({
        Bucket: bucket,
        Key: dstKey,
        Body: output,
        ContentType: 'image/webp',
      }),
    );

    console.log('Successfully resized and uploaded');
  } catch (error) {
    console.error('Error processing file', error);
  }
};
```

ìœ„ì™€ ê°™ì´ Codeë¥¼ ì‘ì„±í•˜ê³  Deployí•˜ì˜€ì§€ë§Œ CloudWatchì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤.
ì—ëŸ¬ ë¡œê·¸ì—ì„œ `sharp` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ë‹¤ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤.

ì´í›„ì— ë³¸ì¸ ë¡œì»¬ì—ì„œ `sharp` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ê³  í•´ë‹¹ íŒŒì¼ë“¤ì„ Zipìœ¼ë¡œ ì••ì¶•í•˜ì—¬ Lambda `.Zip file`ì„ Uploadí•˜ì˜€ë‹¤.

ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ íŒŒì¼ë“¤ì´ ì¡´ì¬í•˜ê²Œ ëœë‹¤.

```
ğŸ“¦lambda-S3
 â”£ ğŸ“‚node_modules
 â”£ ğŸ“œindex.js
 â”£ ğŸ“œpackage-lock.json
 â”— ğŸ“œpackage.json
```

![](https://velog.velcdn.com/images/eunwoo1341/post/64dd702e-7938-4bb1-a952-1da49972e7bc/image.png)

í•´ë‹¹ ìµœì í™” ì‘ì—…ì„ í•˜ê³  ë‚˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì´ë¯¸ì§€ì˜ í¬ê¸°ê°€ ì¤„ì–´ë“¤ê³  í¬ë§·ì´ webpë¡œ ë³€í™˜ë˜ì–´ ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://velog.velcdn.com/images/eunwoo1341/post/21766da0-6ece-45d3-8c2c-db63e6ac1124/image.png)

- Image ìµœì í™” ì „

![](https://velog.velcdn.com/images/eunwoo1341/post/bc9f64cc-26c5-4f80-a20a-496a46fb4e7f/image.png)

- Image ìµœì í™” í›„

rocketì˜ Imageê°€ 1.8MBì—ì„œ 5.2KB, ì¦‰ 97% ì´ë‚˜ ì¤„ì–´ë“  ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

# ë§ˆë¬´ë¦¬

ì´ë²ˆ ì‘ì—…ì„ í†µí•´ Presigned URL â†’ S3 ì§ì—…ë¡œë“œ â†’ S3 ì´ë²¤íŠ¸ â†’ Lambda(Sharp) ë³€í™˜/ë¦¬ì‚¬ì´ì¦ˆë¡œ ì´ì–´ì§€ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì•ˆì •ì ìœ¼ë¡œ êµ¬ì¶•í–ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ,

ì„œë²„ ë¶€í•˜Â·ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì„ íšê¸°ì ìœ¼ë¡œ ì ˆê°í–ˆê³ ,
WebP í‘œì¤€í™”ì™€ ë¦¬ì‚¬ì´ì¦ˆë¡œ ìš©ëŸ‰Â·ë¡œë“œì‹œê°„Â·LCPê°€ ìœ ì˜ë¯¸í•˜ê²Œ ê°œì„ ë˜ì—ˆìœ¼ë©°,
ë¡œì»¬ ë¯¸ë¦¬ë³´ê¸°(Blob) â†’ ì‹¤ì œ S3 URL êµì²´ ì „ëµìœ¼ë¡œ UXÂ·ìºì‹±Â·ê³µìœ ì„±ê¹Œì§€ ì±™ê¸¸ ìˆ˜ ìˆì—ˆë‹¤.
ë³µì¡í•œ ì´ë¯¸ì§€ ì²˜ë¦¬ ë¡œì§ì„ ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë¶„ë¦¬í•˜ì—¬ S3/Lambdaë¡œ ì˜¤í”„ë¡œë“œí•œ ë•ë¶„ì—, í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ íë¦„ì€ ë” ë‹¨ìˆœí•´ì§€ê³  ìš´ì˜ ë¹„ìš©ì€ ë” ë‚®ì•„ì¡Œë‹¤.
