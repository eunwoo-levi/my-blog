---
title: '[React] useSyncExternalStore ì´ìš©í•˜ì—¬ Toast ì‹œìŠ¤í…œ êµ¬í˜„í•˜ê¸°'
author: 'Eunwoo'
thumbnail: '/thumbnail/reactjs.webp'
publishDate: '2025-09-26'
categoryId: 6
---

ì´ì „ì— í”„ë¡œì íŠ¸ì—ì„œëŠ” ë³´í†µ Toast UIë¥¼ êµ¬í˜„í•  ë•ŒëŠ” Context APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì—­ìœ¼ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.
í•˜ì§€ë§Œ í•´ë‹¹ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•  ê²½ìš° ì—¬ëŸ¬ ê³³ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•´ì•¼í•˜ë¯€ë¡œ ì½”ë“œê°€ ë³µì¡í•´ì§€ê³  ìƒíƒœê´€ë¦¬ê°€ ì–´ë ¤ì›Œì§€ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤. ë˜í•œ, ë Œë” ë„ì¤‘ ìƒíƒœê°€ ë°”ë€Œë©´ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

React 18ì˜ ë™ì‹œì„± ë Œë”ë§(Concurrent Rendering) í™˜ê²½ì—ì„œëŠ” í•˜ë‚˜ì˜ "ì™¸ë¶€ ìŠ¤í† ì–´"(Redux/Zustand/EventEmitter/WebSocket ìºì‹œ ë“±)ë¥¼ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ ë™ì‹œì— ì½ê³  ìˆì„ ë•Œ,

- ë Œë” ë„ì¤‘ ìŠ¤í† ì–´ê°€ ë°”ë€Œë©´ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ë‹¤ë¥¸ ìŠ¤ëƒ…ìƒ·ì„ ì½ì–´ ì°¢ì–´ì§(tearing) ì´ ìƒê¸¸ ìˆ˜ ìˆê³ ,
- SSR/í•˜ì´ë“œë ˆì´ì…˜ì—ì„œ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ìŠ¤ëƒ…ìƒ·ì´ ì–´ê¸‹ë‚˜ ê²½ê³ ë‚˜ ì˜ëª»ëœ UIê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆë‹¤.

ê¸°ì¡´ì˜ useEffect + useState íŒ¨í„´ì€ "ë Œë”-êµ¬ë…-ì—…ë°ì´íŠ¸ íƒ€ì´ë°"ì„ Reactê°€ ë³´ì¥í•´ ì£¼ì§€ ì•Šì•„ ì´ ë¬¸ì œë¥¼ ì™„ì „íˆ ë§‰ì§€ ëª»í•œë‹¤.

ì™¸ë¶€ ìƒíƒœë¥¼ "Reactì˜ ë Œë” ì‚¬ì´í´ê³¼ ì¼ì¹˜" í•˜ê²Œ ì½ê³  êµ¬ë…í•´ì•¼ ë™ì‹œì„±ì—ì„œë„ ì¼ê´€ì„±ì´ ë³´ì¥ëœë‹¤. ì´ê±¸ í‘œì¤€í™”í•œ í›…ì´ `useSyncExternalStore`ì´ë‹¤.

# useSyncExternalStoreë€?

[useSyncExternalStore](https://react.dev/reference/react/useSyncExternalStore)ëŠ” ì™¸ë¶€ ìŠ¤í† ì–´ë¥¼ Reactì— ì•ˆì „í•˜ê²Œ ì—°ê²°í•˜ê¸° ìœ„í•œ í”„ë¡œí† ì½œì„ ì œê³µí•œë‹¤.
ìµœê·¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” `Zustand` ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ í•´ë‹¹ í›…ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë˜ì—ˆë‹¤.

useSyncExternalStoreëŠ” ì•„ë˜ì™€ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§„ë‹¤.

- ìŠ¤ëƒ…ìƒ· ì¼ê´€ì„±: ë Œë” ì¤‘ ìŠ¤í† ì–´ê°€ ë³€í•´ë„, ê°™ì€ ë Œë” íŒ¨ìŠ¤ì—ì„œ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ê°™ì€ ê°’ì„ ë³´ê²Œ í•œë‹¤(anti-tearing).
- êµ¬ë… íƒ€ì´ë° ê´€ë¦¬: ì–¸ì œ `subscribe`ë¥¼ ê±¸ê³  í•´ì œí• ì§€, ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸ë¥¼ ì–´ë–»ê²Œ ìŠ¤ì¼€ì¤„í• ì§€ Reactê°€ í†µì œí•œë‹¤.
- SSR/í•˜ì´ë“œë ˆì´ì…˜ ì •í•©ì„±: ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ì´ˆê¸° ìŠ¤ëƒ…ìƒ·ì„ ë§ì¶”ê¸° ìœ„í•œ `getServerSnapshot` ê²½ë¡œë¥¼ ì œê³µí•œë‹¤(í•˜ì´ë“œë ˆì´ì…˜ ë¶ˆì¼ì¹˜ ë°©ì§€).
- ë™ì‹œì„±Â·ì „í™˜ í˜¸í™˜: `startTransition`/Offscreen ë“± ë™ì‹œì„± ê¸°ëŠ¥ê³¼ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë™ì‘í•œë‹¤.

```tsx
const value = useSyncExternalStore(
  subscribe: (onStoreChange: () => void) => () => void,
  getSnapshot: () => T,
  getServerSnapshot?: () => T  // SSR ì „ìš©(í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì„ íƒ)
);
```

- subscribe : ìŠ¤í† ì–´ì— ë³€í™”ê°€ ìƒê¸¸ ë•Œ í˜¸ì¶œí•  ì½œë°±ì„ ë“±ë¡. ë°˜í™˜ê°’ì€ êµ¬ë… í•´ì œ í•¨ìˆ˜.
- getSnapshot : í˜„ì¬ ìŠ¤í† ì–´ì˜ ê°’ì„ ë™ê¸°ì ìœ¼ë¡œ ë°˜í™˜(ìˆœìˆ˜ í•¨ìˆ˜ ê¶Œì¥).
- getServerSnapshot : SSR ì‹œ ì‚¬ìš©í•  ì„œë²„ ì „ìš© ìŠ¤ëƒ…ìƒ·(ì—†ìœ¼ë©´ getSnapshotê³¼ ë¶ˆì¼ì¹˜ë¡œ ê²½ê³ /ê¹œë¹¡ì„ ê°€ëŠ¥).

## useEffect + useStateë¡œëŠ” ì™œ ë¶€ì¡±í•œê°€?

```tsx
// X -> í”í•œ íŒ¨í„´(ë™ì‹œì„±ì—ì„œ ì°¢ì–´ì§ ê°€ëŠ¥)
useEffect(() => {
  const unsub = store.subscribe(() => setState(store.get()));
  return unsub;
}, []);
const value = state;
```

ìœ„ ì½”ë“œëŠ” 2ê°€ì§€ì˜ í° ë¬¸ì œì ì´ ìˆë‹¤.

- 1. ë Œë” ë„ì¤‘ ìŠ¤í† ì–´ê°€ ë°”ë€Œë©´, ì¼ë¶€ ì»´í¬ë„ŒíŠ¸ëŠ” ì´ì „ ê°’, ì¼ë¶€ëŠ” ìƒˆ ê°’ìœ¼ë¡œ ë Œë”ë  ìˆ˜ ìˆìŒ.
- 2. êµ¬ë… íƒ€ì´ë°/ë™ê¸° ìŠ¤ëƒ…ìƒ· ì½ê¸° ë³´ì¥ì´ ì—†ì–´ SSR/í•˜ì´ë“œë ˆì´ì…˜ì—ì„œ ë¶ˆì¼ì¹˜ ê°€ëŠ¥.

ê·¸ë˜ì„œ `useSyncExternalStore`ëŠ” ì´ëŸ° íƒ€ì´ë°ì„ Reactê°€ ì§ì ‘ ê´€ë¦¬í•´ ì´ ë¬¸ì œë¥¼ ì œê±°í•œë‹¤.

ë”°ë¼ì„œ ì •ë¦¬ë¥¼ í•´ë³´ë©´,

`useSyncExternalStore`ëŠ” ì™¸ë¶€ ìŠ¤í† ì–´ë¥¼ Reactì— ë™ì‹œì„±Â·SSR ì•ˆì „í•˜ê²Œ ì—°ê²°í•˜ê¸° ìœ„í•œ í‘œì¤€ í›…ì´ë‹¤. ê°™ì€ ë Œë” ë™ì•ˆ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ê°™ì€ ìŠ¤ëƒ…ìƒ·ì„ ì½ê²Œ í•˜ê³ , êµ¬ë… íƒ€ì´ë°/í•˜ì´ë“œë ˆì´ì…˜ ì¼ê´€ì„±ì„ Reactê°€ ë³´ì¦í•˜ë„ë¡ í•´ ì¤€ë‹¤.

# Toast êµ¬í˜„ - 1. createStore & useStore

`useSyncExternalStore`ë¥¼ ì´ìš©í•˜ì—¬ Toast UIë¥¼ êµ¬í˜„í•´ë³´ì•˜ë‹¤.

ë¨¼ì € `Store` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ê³ , `createStore` í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ `Store` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ì‘ì€ ì „ì—­ Storeë¥¼ êµ¬í˜„í•˜ì˜€ë‹¤.
ê·¸ë¦¬ê³  ì¶”ê°€ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•˜ì˜€ë‹¤.

- `createStore`ë¡œ (state, listeners)ë¥¼ í´ë¡œì €ì— ê°ì¶”ê³ ,
- `getState` / `setState` / `subscribe` 3ê°€ì§€ë¥¼ ë…¸ì¶œí•œë‹¤.
- ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” `useStore(store)`ë¥¼ í˜¸ì¶œí•˜ë©´, useSyncExternalStoreê°€ ì•ˆì „í•œ êµ¬ë…ì„ ë‹´ë‹¹í•œë‹¤.

ëŒ€ëµì ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```tsx
import { useSyncExternalStore } from 'react';

type StoreSubscriber = () => void;

export interface Store<TState> {
  getState: () => TState;
  setState: (value: TState | ((prev: TState) => TState)) => void;
  subscribe: (callback: StoreSubscriber) => () => void;
}

export function createStore<TState>(initialState: TState): Store<TState> {
    ...
}

export function useStore<TState>(store: Store<TState>): TState {
  return useSyncExternalStore(store.subscribe, store.getState, store.getState);
}

```

ìœ„ ì½”ë“œë¥¼ ë³´ë©´ `setState` ì€

```tsx
// ëª¨ë“  toasts ì´ˆê¸°í™”
toastStore.setState({ toasts: [] });
```

ì™€ ê°™ì´ ì§ì ‘ ê°’ì„ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆê³ ,

```tsx
// ê¸°ì¡´ toastsì— ìƒˆë¡œìš´ toast ì¶”ê°€
toastStore.setState((state) => ({ toasts: [...state.toasts, newToast] }));

// íŠ¹ì • toast ì œê±°
toastStore.setState((state) => ({ toasts: state.toasts.filter((t) => t.id !== id) }));
```

ì™€ ê°™ì´ í•¨ìˆ˜ í˜•íƒœë¡œë„ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.

ì´ëŠ” Reactì˜ `useState`ì™€ ë™ì¼í•œ íŒ¨í„´ì„ ë”°ë¥´ê¸° ìœ„í•¨ì´ë‹¤.
ì´ì²˜ëŸ¼ í•¨ìˆ˜ í˜•íƒœë¡œ ì¸ìë¥¼ ì¤„ ê²½ìš° ì¥ì ì€ `Race Condition`ë¥¼ ë°©ì§€í•˜ì—¬ ìµœì‹  ìƒíƒœë¥¼ í•­ìƒ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.

## createStore ë¶„ì„

ì´í›„ `createStore` í•¨ìˆ˜ë¥¼ í†µí•´ `Store` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ì‘ê³  ì•ˆì „í•œ ì™¸ë¶€ ìŠ¤í† ì–´ì´ë‹¤.

```tsx
export function createStore<TState>(initialState: TState): Store<TState> {
  let state = initialState;
  const listeners = new Set<StoreSubscriber>();

  return {
    getState: () => state,
    setState: (value) => {
      const newState =
        typeof value === 'function' ? (value as (prev: TState) => TState)(state) : value;
      if (newState !== state) {
        state = newState;
        listeners.forEach((listener) => listener());
      }
    },
    subscribe: (callback) => {
      listeners.add(callback);
      return () => listeners.delete(callback);
    },
  };
}
```

ë‚´ë¶€ êµ¬í˜„ì„ ë³´ë©´ "ìƒíƒœ+êµ¬ë…ì"ë¥¼ ë‚´ë¶€ì— ê°ì¶˜ ë’¤, ì¡°ì‘ìš© ë©”ì„œë“œë§Œ ì™¸ë¶€ë¡œ ë‚´ë³´ë‚´ëŠ” íŒ©í† ë¦¬ í•¨ìˆ˜ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

```tsx
let state = initialState;
const listeners = new Set<StoreSubscriber>();
```

ìœ„ì˜ ë‘ ìƒíƒœë“¤ì€ ë‚´ë¶€ í´ë¡œì €(ì€ë‹‰ëœ ìƒíƒœ + êµ¬ë…ì)ë¡œ,

`state`: í˜„ì¬ ìƒíƒœë¥¼ ì €ì¥. í•¨ìˆ˜ ë°–ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€(ìº¡ìŠí™”).
`listeners`: ë³€ê²½ ì•Œë¦¼ì„ ë°›ì„ êµ¬ë…ì ì½œë°± ì§‘í•©
ì´ë‹¤.

listenersëŠ” Setì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ì¤‘ë³µ êµ¬ë…ì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ê³¼ add/deleteë¥¼ ë¹ ë¥´ê³  ê°„ë‹¨í•˜ê²Œ í•˜ê³ , ìˆœíšŒê°€ ì‰½ê¸° ë•Œë¬¸ì´ë‹¤.
ì´ ë‘˜ì€ í´ë¡œì €ì— ë³´ê´€ë˜ì–´ ì™¸ë¶€ì—ì„œ ì„ì˜ë¡œ ë°”ê¿€ ìˆ˜ ì—†ë‹¤. ì˜¤ì§ `getState` / `setState` / `subscribe` ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼í•˜ë‹¤.

`getState`ë¥¼ ë¨¼ì € ë³´ë©´,

```tsx
getState: () => state,
```

í•­ìƒ ë™ê¸°ì ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ ë°˜í™˜í•œë‹¤.
useSyncExternalStoreê°€ ë Œë” ì‹œì ë§ˆë‹¤ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ì¼ê´€ëœ ìŠ¤ëƒ…ìƒ·ì„ ì½ëŠ”ë‹¤(anti-tearingì˜ í•µì‹¬ ì¡°ê±´).

`setState`ëŠ” ìƒíƒœ ê°±ì‹ (ì§ì ‘ ê°’ or ì—…ë°ì´í„° í•¨ìˆ˜)í•˜ê³ , ë³€ê²½ ì‹œì—ë§Œ êµ¬ë…ìë“¤ì—ê²Œ í†µì§€í•œë‹¤.

```tsx
setState: value => {
  const newState =
    typeof value === 'function' ? (value as (prev: TState) => TState)(state) : value;
  if (newState !== state) {
    state = newState;
    listeners.forEach(listener => listener());
  }
},
```

valueê°€ í•¨ìˆ˜ë©´ "ì—…ë°ì´í„° í•¨ìˆ˜"ë¡œ ë³´ê³  (prev) => next í˜•íƒœë¡œ í˜„ì¬ stateë¥¼ ë„£ì–´ í˜¸ì¶œí•˜ê³ , ê°’ì´ë©´ ê·¸ëŒ€ë¡œ ìƒˆ ìƒíƒœë¡œ ì‚¬ìš©í•œë‹¤.
`newState !== state`ì¼ ë•Œë§Œ ê°±ì‹ /ì•Œë¦¼ì„ í•˜ëŠ”ë°, ì´ë¥¼ í†µí•´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
ì´í›„ `listeners.forEach(listener => listener());`ë¥¼ í†µí•´ êµ¬ë…ìë“¤ì—ê²Œ í†µì§€í•œë‹¤.

`subscribe`ëŠ” êµ¬ë… ë“±ë¡/í•´ì œí•˜ëŠ” ì—­í• ì„ í•œë‹¤.

ë“±ë¡ì€ `listeners.add(callback)`ì´ê³ ,
í•´ì œ í•¨ìˆ˜ ë°˜í™˜ì€ `listeners.delete(callback)`ë¥¼ í†µí•´ Reactê°€ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ì •ë¦¬(cleanup) í•œë‹¤.

useSyncExternalStoreëŠ” ì»¤ë°‹ ì‹œì ì— êµ¬ë…ì„ ê±¸ê³ , ì–¸ë§ˆìš´íŠ¸ ì‹œ í•´ì œí•´ì„œ
Strict Modeì˜ ì´ì¤‘ í˜¸ì¶œ/ë™ì‹œì„±ì—ì„œë„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì—†ì´ ì•ˆì „í•˜ê²Œ ë™ì‘í•œë‹¤.

## useStore ë¶„ì„

`useStore`ëŠ” ì™¸ë¶€ ìŠ¤í† ì–´(store)ë¥¼ Reactì— ì•ˆì „í•˜ê²Œ ì—°ê²°í•˜ê³ , ìŠ¤í† ì–´ì˜ í˜„ì¬ ìŠ¤ëƒ…ìƒ·(TState) ì„ ë¦¬í„´í•œë‹¤.
ë‚´ë¶€ì ìœ¼ë¡œ `useSyncExternalStore`ë¥¼ ì‚¬ìš©í•´ ë™ì‹œì„±(Concurrent)Â·StrictModeÂ·SSRì—ì„œ ìŠ¤ëƒ…ìƒ· ì¼ê´€ì„±ì„ ë³´ì¥í•œë‹¤.

â€œConcurrentâ€ëŠ” Reactê°€ ë Œë”ë§ì„ ë” ì˜ ìŠ¤ì¼€ì¤„ë§í•  ìˆ˜ ìˆê²Œ ë§Œë“  ì‹¤í–‰ ëª¨ë¸ì„ ë§í•œë‹¤. í•µì‹¬ì€ ì¸í„°ëŸ½íŠ¸ ê°€ëŠ¥(ì¤‘ë‹¨Â·ì¬ê°œ ê°€ëŠ¥)í•œ ë Œë”ë§ê³¼ ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§ì´ë‹¤.
ì´ë¦„ ë•Œë¬¸ì— "ë³‘ë ¬(ë©€í‹°ìŠ¤ë ˆë“œ)ë¡œ ë™ì‹œì— ê·¸ë¦°ë‹¤"ë¡œ ì˜¤í•´í•˜ê¸° ì‰¬ìš´ë°, ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ë©° "ë™ì‹œì— í•  ìˆ˜ ìˆê²Œ ë³´ì´ë„ë¡" ì¼ì •ê³¼ ì¡°ê°í™”ë¥¼ ì˜í•˜ëŠ” ê±°ë¼ê³  ë³´ë©´ ëœë‹¤.

useSyncExternalStoreì˜ 3ê°€ì§€ ì¸ìë¥¼ ë¶„ì„í•´ë³´ë©´,

1. `store.subscribe: (onStoreChange) => unsubscribe`

   - Reactê°€ ì»¤ë°‹ ì‹œì ì— ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ êµ¬ë…ì„ ì„¤ì •í•œë‹¤.
   - ìŠ¤í† ì–´ ê°’ì´ ë°”ë€Œë©´ ë‚´ë¶€ì—ì„œ onStoreChange()ë¥¼ í˜¸ì¶œ â†’ Reactê°€ "ì—…ë°ì´íŠ¸ í•„ìš”"ë¡œ í‘œì‹œ.
   - ë°˜í™˜ëœ unsubscribeëŠ” ì–¸ë§ˆìš´íŠ¸/ì¬ì»¤ë°‹ ì‹œ ì •ë¦¬ì— ì‚¬ìš©ëœë‹¤. (StrictModeì—ì„œ mount/unmountê°€ í•œ ë²ˆ ë” ì¼ì–´ë‚˜ë„ ëˆ„ìˆ˜ ì—†ì´ ì•ˆì „)

2. `store.getState: () => TState (getSnapshot)`

   - Reactê°€ ë Œë” ìˆœê°„ë§ˆë‹¤ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ í˜„ì¬ ìŠ¤ëƒ…ìƒ·ì„ "ë™ê¸°ì ìœ¼ë¡œ" ì½ëŠ”ë‹¤.
   - ê°™ì€ ë Œë” íŒ¨ìŠ¤ì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ë™ì¼í•œ ê°’ì„ ë³´ë„ë¡ í•´ "ì°¢ì–´ì§(anti-tearing)"ì„ ë°©ì§€í•œë‹¤.

3. `store.getState: () => TState (getServerSnapshot)`
   - SSRì„ í•˜ëŠ” í™˜ê²½ì´ë¼ë©´ ì„œë²„ ë Œë”ë§ì—ì„œ ì“¸ ì´ˆê¸° ìŠ¤ëƒ…ìƒ·ì´ë‹¤.
   - ì—¬ê¸°ì„œëŠ” ì„œë²„/í´ë¼ ì´ˆê¸° ìƒíƒœê°€ ë™ì¼(ì˜ˆ: í† ìŠ¤íŠ¸ ì´ˆê¸°ê°’ [])í•˜ë¯€ë¡œ ê°™ì€ í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•´ë„ ì•ˆì „í•˜ë‹¤.
   - CSR ì „ìš©ì´ë¼ë©´ 3ë²ˆì§¸ ì¸ìëŠ” ìƒëµí•´ë„ ëœë‹¤.

## React ìƒëª… ì£¼ê¸°ì˜ ê´€ì 

- 1. Render phase (ë Œë” ë‹¨ê³„) (ìˆœìˆ˜ ê³„ì‚°ë§Œ í•˜ëŠ” ë‹¨ê³„. JSXë¥¼ ë§Œë“¤ê³  "í™”ë©´ì— ì˜¬ë¦´ í›„ë³´"ë¥¼ ì¤€ë¹„)
     Reactê°€ `getState()`ë¥¼ í˜¸ì¶œí•´ ìŠ¤ëƒ…ìƒ· Aë¥¼ ì–»ì–´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”í•œë‹¤.

- 2. Commit phase (ì»¤ë°‹ ë‹¨ê³„) (ì¤€ë¹„ëœ ê²°ê³¼ë¥¼ ì‹¤ì œ DOMì— ë°˜ì˜í•˜ëŠ” ë‹¨ê³„)
     Reactê°€ `subscribe(onStoreChange)`ë¡œ êµ¬ë…ì„ ë“±ë¡í•œë‹¤.

- 3. ìŠ¤í† ì–´ ë³€ê²½ ë°œìƒ
     ì™¸ë¶€ì—ì„œ `setState(...)` í˜¸ì¶œ â†’ ë‚´ë¶€ `listeners.forEach(l => l())` â†’ `onStoreChange()` ì‹¤í–‰.

- 4. ì¬ë Œë” ìŠ¤ì¼€ì¤„ë§
     Reactê°€ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”í•˜ë©´ì„œ ë‹¤ì‹œ `getState()` ë¥¼ í˜¸ì¶œí•´ ìŠ¤ëƒ…ìƒ· Bë¥¼ ì½ëŠ”ë‹¤.
     ìŠ¤ëƒ…ìƒ· ë¹„êµ ê²°ê³¼ê°€ ë‹¤ë¥´ë©´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë§Œ ë¦¬ë Œë”ë©ë‹ˆë‹¤.

- 5. ì–¸ë§ˆìš´íŠ¸/ì¬ì»¤ë°‹
     Reactê°€ `unsubscribe()` í˜¸ì¶œë¡œ êµ¬ë…ì„ í•´ì œí•œë‹¤.

í•µì‹¬ì€ "ê°’ ì „ë‹¬"ì€ í•­ìƒ `getState()`ë¡œë§Œ, "ë³€ê²½ í†µì§€"ëŠ” `subscribe` ì½œë°±ìœ¼ë¡œë§Œ ì´ë¤„ì§„ë‹¤. ì´ í”„ë¡œí† ì½œ ë•ë¶„ì— ë™ì‹œì„±Â·SSRì—ì„œë„ ì‹œì ì´ ì—‡ê°ˆë¦¬ì§€ ì•ŠëŠ”ë‹¤.

# Toast êµ¬í˜„ - 2. toast ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¡œì§

## Toast ì¶”ê°€

```tsx
import { createStore, useStore } from './core';
import { ToastData, ToastRouteType, ToastsState } from '@/shared/types/toast';

const toastStore = createStore<ToastsState>({ toasts: [] });

const timers = new Map<string, ReturnType<typeof setTimeout>>();
const generateId = () => `toast-${Date.now()}-${Math.random().toString(36).slice(2, 11)}`;

export const useToasts = () => useStore(toastStore);

function addToast(toast: Omit<ToastData, 'id'>) {
  const id = generateId();
  const newToast = { ...toast, id };
  toastStore.setState((state) => ({ toasts: [...state.toasts, newToast] }));

  const duration = toast.duration ?? 3000;
  if (duration > 0) {
    const prev = timers.get(id);
    if (prev) clearTimeout(prev); // ì´ ì¤„ì€ í˜„ì¬ ë¡œì§ìƒ ê±°ì˜ í•„ìš” ì—†ì§€ë§Œ ì•ˆì „ë§
    const handle = setTimeout(() => {
      timers.delete(id); // íƒ€ì´ë¨¸ ë§µ ì •ë¦¬
      removeToast(id); // ì‹¤ì œ ì œê±°
    }, duration);
    timers.set(id, handle);
  }
  return id;
}
```

ì´ì „ì— êµ¬í˜„í•œ `createStore` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì—­ í† ìŠ¤íŠ¸ ìƒíƒœë¥¼ ë‹´ëŠ” ì™¸ë¶€ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì„ ì‚´í´ë³´ì•˜ê³  ì´ë²ˆì—ëŠ” í•´ë‹¹ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” í›…ì„ êµ¬í˜„í•˜ëŠ” ë¡œì§ì„ ì‚´í´ë³´ë ¤ê³  í•œë‹¤.

```tsx
const toastStore = createStore<ToastsState>({ toasts: [] });
```

ì „ì—­ í† ìŠ¤íŠ¸ ìƒíƒœë¥¼ ë‹´ëŠ” ì™¸ë¶€ ìŠ¤í† ì–´(ì´ˆê¹ƒê°’: ë¹ˆ ë°°ì—´)ì´ë‹¤.

```tsx
export const useToasts = () => useStore(toastStore);
```

í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ëŠ” ì´ í›…ìœ¼ë¡œ í˜„ì¬ ìŠ¤ëƒ…ìƒ·ì„ ë™ì‹œì„± ì•ˆì „í•˜ê²Œ ì½ëŠ”ë‹¤.

ì´í›„ íƒ€ì´ë¨¸ ê´€ë¦¬ ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ë‹¤.

```tsx
const timers = new Map<string, ReturnType<typeof setTimeout>>();
```

ê° í† ìŠ¤íŠ¸ idë§ˆë‹¤ ìë™ ì œê±°ìš© íƒ€ì´ë¨¸ë¥¼ ì €ì¥/ì •ë¦¬í•˜ê³ ,
í•µì‹¬ì€ ì´í›„ ì‚´í´ë³¼ `hide`/`clear` ì‹œ `clearTimeout`ì„ í˜¸ì¶œí•˜ë¯€ë¡œ ë’¤ëŠ¦ì€ íƒ€ì´ë¨¸ê°€ ìƒíƒœë¥¼ ë‹¤ì‹œ ê±´ë“œë¦¬ëŠ” ë ˆì´ìŠ¤ë¥¼ ë°©ì§€í•œë‹¤.

`addToast`í•¨ìˆ˜ì—ì„œ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•´ì„œ ë¶ˆë³€ ì—…ë°ì´íŠ¸ë¥¼ í•˜ì—¬ ìƒˆ ë°°ì—´ì„ ë§Œë“¤ì–´ ë„£ê¸° ë•Œë¬¸ì— êµ¬ë…ìì—ê²Œ ë³€ê²½ í†µì§€ê°€ ì˜ ê°„ë‹¤.

## Toast ì œê±°

```tsx
function removeToast(id: string) {
  const t = timers.get(id);
  if (t) {
    clearTimeout(t);
    timers.delete(id);
  }
  toastStore.setState((state) => ({ toasts: state.toasts.filter((t) => t.id !== id) }));
}
```

ìˆ˜ë™ ì œê±°í•˜ê³ , ì¤‘ë³µ í˜¸ì¶œì—ë„ íƒ€ì´ë¨¸ ì •ë¦¬ â†’ ìƒíƒœ ê°±ì‹ ì„ í•˜ê¸° ë•Œë¬¸ì— ì•ˆì „í•˜ë‹¤.

## ê³µê°œ API

```tsx
export const toasts = {
  success: (message: string, duration?: number) =>
    addToast({ message, variant: 'success', duration }),

  error: (message: string, duration?: number) => addToast({ message, variant: 'error', duration }),

  warning: (message: string, duration?: number) =>
    addToast({ message, variant: 'warning', duration }),

  message: (message: string, routeType?: ToastRouteType, duration?: number) =>
    addToast({ message, variant: 'message', routeType, duration }),

  hide: (id: string) => removeToast(id),
  clear: () => {
    timers.forEach((t) => clearTimeout(t));
    timers.clear();
    toastStore.setState({ toasts: [] });
  },
} as const;
```

ë‹¨ì¼ ì§„ì…ì ìœ¼ë¡œ ì‚¬ìš©ì„±ì´ ì¢‹ê³ , clearë„ íƒ€ì´ë¨¸â†’ìƒíƒœ ìˆœì„œë¡œ ì˜ ì •ë¦¬í•œë‹¤.

## Toast êµ¬í˜„ - 3. useToast í›… êµ¬í˜„

```tsx
import { toasts } from '@/shared/store/toast';
import { ToastRouteType, UseToastReturn } from '@/shared/types/toast';

export const useToast = (): UseToastReturn => {
  return {
    showSuccess: (message: string, duration?: number) => toasts.success(message, duration),
    showError: (message: string, duration?: number) => toasts.error(message, duration),
    showWarning: (message: string, duration?: number) => toasts.warning(message, duration),
    showMessage: (message: string, routeType?: ToastRouteType, duration?: number) =>
      toasts.message(message, routeType, duration),
    removeToast: () => toasts.clear(),
  };
};
```

ìœ„ í›…ì€ ì „ì—­ toasts APIë¥¼ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì“°ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ê°ì‹¸ì„œ ë‚´ë³´ë‚´ëŠ” facade í›…ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤

`showSuccess` / `showError` / `showWarning` / `showMessage`ëŠ” í† ìŠ¤íŠ¸ ìƒì„±í•¨ìˆ˜ë“¤ì´ê³ ,
`removeToast` â†’ ëª¨ë“  í† ìŠ¤íŠ¸ ì œê±°(clear)í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

## Toast UI êµ¬í˜„

```tsx
import { toasts, useToasts } from '@/shared/store/toast';

export const Toast: React.FC = () => {
  const { toasts: activeToasts } = useToasts();

  if (activeToasts.length === 0) {
    return null;
  }

  return createPortal(
    <S.ToastContainer>
      {activeToasts.map((toast) => (
        <ToastItem key={toast.id} toast={toast} onClose={toasts.hide} />
      ))}
    </S.ToastContainer>,
    document.body,
  );
};
```

ìœ„ ì½”ë“œëŠ” Toast UIë¥¼ êµ¬í˜„í•œ ì½”ë“œì´ë‹¤.

#### Toast

- `useToasts()`ë¡œ ì „ì—­ ìŠ¤í† ì–´ì˜ toasts ë°°ì—´ì„ êµ¬ë….
- í•˜ë‚˜ ì´ìƒì´ë©´ `createPortal`ë¡œ document.body ì•„ë˜ì— ì»¨í…Œì´ë„ˆë¥¼ ë¶™ì—¬ ë Œë”.
- ê° í•­ëª©ì€ ToastItemìœ¼ë¡œ ê·¸ë¦°ë‹¤. onCloseë¡œ ì „ì—­ `toasts.hide`ë¥¼ ë°”ë¡œ ì‚¬ìš©.

#### ToastItem

- ì•„ì´ì½˜ ë§¤í•‘(success/error/warning/message)ê³¼ ë©”ì‹œì§€ í‘œì‹œ.
- ë‹«ê¸°(X) í´ë¦­ ì‹œ isExitingì„ trueë¡œ ë§Œë“¤ì–´ ì¢…ë£Œ ì• ë‹ˆë©”ì´ì…˜ì„ íŠ¸ë¦¬ê±°í•˜ê³ , 300ms ë’¤ì— onClose(id)ë¡œ ì‹¤ì œ ì œê±°.
- message íƒ€ì…ì´ê³  routeTypeì´ ìˆìœ¼ë©´ í´ë¦­ ì‹œ ë¼ìš°íŒ…(moment â†’ /collection/my-moment, ì•„ë‹ˆë©´ /collection/my-comment) í›„ ë‹«ê¸°.

ì´í›„ ìµœìƒìœ„ì¸µ `Layout.tsx`ì—ì„œ `Toast` ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•˜ì—¬ ë Œë”ë§í•˜ë„ë¡ í•˜ì˜€ë‹¤.

## useToast ì‚¬ìš©ë²•ê³¼ ì „ì²´ íë¦„ ì‚´í´ë³´ê¸°

```tsx
import { useCheckIfLoggedInQuery } from '@/features/auth/api/useCheckIfLoggedInQuery';
import { useToast } from '@/shared/hooks';
import React from 'react';
import { Navigate, Outlet, useLocation } from 'react-router';
import { ROUTES } from './routes';
import { AxiosError } from 'axios';

export const ProtectedRoute: React.FC = () => {
  const location = useLocation();
  const { showWarning } = useToast();
  const { data: isLoggedIn, isLoading, isError, error } = useCheckIfLoggedInQuery();

  if (isLoading) {
    return <div>ë¡œë”© ì¤‘...</div>;
  }

  if (isLoggedIn === false || (isError && (error as AxiosError)?.response?.status === 401)) {
    showWarning('Momentì— ì˜¤ì‹  ê±¸ í™˜ì˜í•´ìš”! ë¡œê·¸ì¸í•˜ê³  ì‹œì‘í•´ë³´ì„¸ìš” ğŸ’«', 3000);
    return <Navigate to={ROUTES.LOGIN} state={{ from: location }} replace />;
  }

  return <Outlet />;
};
```

`showWarning`ì„ ì‚¬ìš©í•˜ì—¬ ê²½ê³  Toastë¥¼ ë„ìš°ê³  ì‹¶ì€ ê²½ìš° ìœ„ì™€ ê°™ì´ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
í˜¸ì¶œí•˜ëŠ” ê³³ì—ì„œ `useToast` í›…ì—ì„œ í˜¸ì¶œí•˜ë©´ ê·¸ í›…ì•ˆì— ìˆëŠ” `toasts.warning`ì„ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.

```tsx
export const useToast = (): UseToastReturn => {
    return {
        ...
    showWarning: (message: string, duration?: number) => toasts.warning(message, duration),
    ...
    }
}
```

ê·¸ëŸ¼ `toasts` ê°ì²´ê°€ í˜¸ì¶œí•˜ê²Œ ë˜ëŠ”ë° ì•„ë˜ë¥¼ í™•ì¸í•´ë³´ì.

```ts
const toastStore = createStore<ToastsState>({ toasts: [] });

...

function addToast(toast: Omit<ToastData, 'id'>) {
    ...
      toastStore.setState(state => ({ toasts: [...state.toasts, newToast] }));
    ...
}

export const toasts = {
    warning: (message: string, duration?: number) =>
        addToast({ message, variant: 'warning', duration }),
}  as const;
...

```

`toasts` ê°ì²´ ì•ˆì—ì„œ `warning`ë¥¼ í˜¸ì¶œí•˜ë©´ `addToast`ë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.

`addToast` í•¨ìˆ˜ë¥¼ ë³´ë©´ `toastStore.setState`ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ëŠ”ë° `toastStore` ê°ì²´ëŠ” `createStore` í•¨ìˆ˜ë¥¼ í†µí•´ ìƒì„±ëœ ì „ì—­ ìŠ¤í† ì–´ì´ë‹¤.
ì´í›„ `toastStore` ê°ì²´ ì•ˆì— ìˆëŠ” `setState` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ëŠ”ë° ì´ í•¨ìˆ˜ëŠ” `toastStore` ê°ì²´ ì•ˆì— ìˆëŠ” `state` ê°ì²´ë¥¼ ë³€ê²½í•˜ê²Œ ëœë‹¤.

### ì „ì²´ íë¦„ ì •ë¦¬

- ProtectedRouteì—ì„œ ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•œë‹¤.
- ë¹„ë¡œê·¸ì¸/401ì´ë©´ `showWarning()`ìœ¼ë¡œ í† ìŠ¤íŠ¸ë¥¼ ìš”ì²­í•œë‹¤.
- useToast â†’ toasts.warning â†’ `addToast` â†’ `toastStore.setState` ìˆœì„œë¡œ ì „ì—­ ìƒíƒœê°€ ê°±ì‹ ëœë‹¤.
- `<Toast />`ê°€ `useToasts()`ë¡œ ìŠ¤í† ì–´ë¥¼ êµ¬ë… ì¤‘ì´ë¼, ìƒíƒœ ë³€ê²½ì„ ê°ì§€í•˜ê³  ìƒˆ í† ìŠ¤íŠ¸ë¥¼ ë Œë”í•œë‹¤.
- durationì´ ì§€ë‚˜ë©´ toast.tsì˜ íƒ€ì´ë¨¸ê°€ `removeToast()`ë¥¼ í˜¸ì¶œí•´ í† ìŠ¤íŠ¸ë¥¼ ì œê±°í•œë‹¤.

# ì „ì²´ íë¦„ ë‹¤ì´ì–´ê·¸ë¨

<img
  src='https://velog.velcdn.com/images/eunwoo1341/post/6cc84838-ad9f-4b5b-9ea3-365922b31743/image.png'
  alt='diagram'
  width='420'
  style={{ height: 'auto' }}
  loading='lazy'
/>
